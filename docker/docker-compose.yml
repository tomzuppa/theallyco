version: '3.9'

services:
  web:
    # ğŸ›  Build from the Dockerfile in the root context
    build:
      context: ..
      dockerfile: docker/Dockerfile

    # ğŸ³ Container name for easier debugging
    container_name: django_web

    # ğŸš€ Main command to run the app inside the container
    command: >
      sh -c "
        echo 'ğŸ›  Applying migrations...' &&
        python manage.py migrate &&
        
        # ğŸ‘‡ Development mode: use Django built-in server
        python manage.py runserver 0.0.0.0:8000

        # ğŸ‘‡ Production mode (comment above, uncomment below):
        # gunicorn project_root.wsgi:application --bind 0.0.0.0:8000
      "

    # ğŸ”„ Mount project directory inside the container for live reload
    volumes:
      - ..:/app

    # ğŸŒ Map container port 8000 to host port 8000
    ports:
      - "8000:8000"

    # ğŸ” Load environment variables from your .env file
    env_file:
      - ../.env

    # ğŸ” Auto-restart if the container stops
    restart: unless-stopped

