{% extends 'base.html' %}
{% load static %}
{% load widget_tweaks %}

{% block title %}Set New Password{% endblock %}
{% block body_class %}auth-page{% endblock %}

{% block content %}
<section class="vh-100 d-flex align-items-center justify-content-center">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-6 col-lg-5 col-xl-4">
        <div class="card auth-card border-0">
          <div class="card-body p-5">
            
            {% if validlink %}
              <!-- Lock Icon for Password Reset -->
              <div class="auth-icon">
                <svg width="24" height="24" fill="white" viewBox="0 0 24 24">
                  <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
                </svg>
              </div>

              <h2 class="text-center auth-title">Set New Password</h2>
              <p class="text-center auth-subtitle">Please enter your new password twice for confirmation.</p>

              <form method="post" class="auth-form">
                {% csrf_token %}
                
                <div class="auth-form-group mb-4">
                  <label for="{{ form.new_password1.id_for_label }}" class="form-label">New Password</label>
                  {% render_field form.new_password1 class="form-control" placeholder="Enter your new password" %}
                  {% if form.new_password1.help_text %}
                    <div class="password-rules mt-2 small text-muted">
                      {{ form.new_password1.help_text|safe }}
                    </div>
                  {% endif %}
                </div>
                
                <div class="auth-form-group mb-4">
                  <label for="{{ form.new_password2.id_for_label }}" class="form-label">Confirm New Password</label>
                  {% render_field form.new_password2 class="form-control" placeholder="Confirm your new password" %}
                </div>
                
                <div class="auth-form-group d-grid mb-4">
                  <button type="submit" class="btn btn-primary">
                    <svg width="16" height="16" fill="currentColor" class="me-2" viewBox="0 0 24 24">
                      <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                    </svg>
                    Update Password
                  </button>
                </div>
              </form>

            {% else %}
              <!-- Error Icon for Invalid Link -->
              <div class="auth-icon" style="background: linear-gradient(135deg, var(--alert-error), #cc0000);">
                <svg width="24" height="24" fill="white" viewBox="0 0 24 24">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
              </div>

              <h2 class="text-center auth-title">Link Expired</h2>
              <p class="text-center auth-subtitle">This password reset link is invalid or has already been used.</p>

              <div class="alert alert-danger text-center border-0" style="background-color: rgba(255, 76, 76, 0.1); color: var(--alert-error);">
                <svg width="16" height="16" fill="currentColor" class="me-2" viewBox="0 0 24 24">
                  <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
                </svg>
                Please request a new password reset link to continue.
              </div>

              <div class="d-grid">
                <a href="{% url 'reset_password' %}" class="btn btn-primary">
                  <svg width="16" height="16" fill="currentColor" class="me-2" viewBox="0 0 24 24">
                    <path d="M19 8l-4 4h3c0 3.31-2.69 6-6 6-1.01 0-1.97-.25-2.8-.7l-1.46 1.46C8.97 19.54 10.43 20 12 20c4.42 0 8-3.58 8-8h3l-4-4zM6 12c0-3.31 2.69-6 6-6 1.01 0 1.97.25 2.8.7l1.46-1.46C15.03 4.46 13.57 4 12 4c-4.42 0-8 3.58-8 8H1l4 4 4-4H6z"/>
                  </svg>
                  Request New Link
                </a>
              </div>

              <div class="auth-divider"></div>

              <div class="text-center">
                <a href="{% url 'users:login' %}" class="auth-link">
                  <svg width="14" height="14" fill="currentColor" class="me-1" viewBox="0 0 24 24">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                  </svg>
                  Back to Login
                </a>
              </div>
            {% endif %}

          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}